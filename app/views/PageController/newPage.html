#{extends 'main.html' /}
#{set title:'New Page' /}

%{
    models.Page otherPage;
}%

#{if otherUrlId}
<p>You are currently translating ${otherUrlId} from ${language}.</p>
%{
    otherPage = models.Page.getPageByLocale(otherUrlId, new java.util.Locale(language));
}%
#{/if}

#{form @PageController.doNewPage() , id:'creationForm', enctype:'multipart/form-data' }

#{field 'page.urlId'}
<p>
    <label>&{field.name}</label>
    <input type="text" id="${field.id}" name="${field.name}" value="${field.flash}" class="${field.errorClass}" />
    <span class="error">${field.error}</span>
</p>
#{/}

#{field 'pageReference.tags'}
<p>
    <label>&{field.name}</label>
    %{
        if (field.flash == null && otherPage != null)
            field.flash = otherPage.pageReference.getTagsAsString();
    }%
    <input type="text" id="${field.id}" name="${field.name}" value="${field.flash}" class="${field.errorClass}" />
    <span class="error">${field.error}</span>
</p>
#{/}

#{field 'page.title'}
<p>
    <label>&{field.name}</label>
    %{
        if (field.flash == null && otherPage != null)
            field.flash = otherPage.title;
    }%
    <input type="text" id="${field.id}" name="${field.name}" value="${field.flash}" class="${field.errorClass}" />
    <span class="error">${field.error}</span>
</p>
#{/}

#{field 'page.content'}
<p>
    <label>&{field.name}</label>
    %{
        if (field.flash == null && otherPage != null)
            field.flash = otherPage.content;
    }%
    <textarea id="${field.id}" name="${field.name}" class="${field.errorClass}" cols="50" rows="10">${field.flash}</textarea>
    <span class="error">${field.error}</span>
</p>
#{/}

#{field 'page.language'}
<p>
    <label>&{field.name}</label>
    <select id="${field.id}" name="${field.name}" class="${field.errorClass}">
    #{list items:controllers.I18nController.getAllLocalesAsStrings(language), as:'l'}
        <option value="${l}" ${field.flash?.toString().equals(l) || (field.flash == null && request.acceptLanguage().get(0)?.substring(0, 2).equals(l.toString()))? 'selected="true"'.raw() : ''}>${l}</option>
    #{/list}
    </select>
    <span class="error">${field.error}</span>
</p>
#{/}

#{field 'page.published'}
<p>
    <label>&{field.name}</label>
    <input id="${field.id}" name="${field.name}" class="${field.errorClass}" type="checkbox" %{if (field.flash != null && field.flash) {}%checked%{}}%/>
    <span class="error">${field.error}</span>
</p>
#{/}

<input type="hidden" name="linkto.otherUrlId" value="${otherUrlId}" />
<input type="submit" value="ok" />

#{/form}
